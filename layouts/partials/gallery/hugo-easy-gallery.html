<div class="gallery caption-position-bottom caption-effect-slide hover-effect-zoom hover-transition" itemscope itemtype="http://schema.org/ImageGallery">

    {{ with .Resources.ByType "image" }}
        {{ range where . ".Params.imagegallery" "eq" true }}

            {{ $thumbImage := .Fit "300x300" }}
            {{ $fullImage := .Fit "1000x1000" }}

            <div class="box fancy-figure caption-position-bottom caption-effect-slide" style="max-width:756px">
              <figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
                <div class="img" style="background-image: url('{{ $thumbImage.RelPermalink }}');">
                    <img itemprop="thumbnail" src="{{ $thumbImage.RelPermalink }}" alt="{{ .Title }}" /><!-- <img> hidden if in .gallery -->
                </div>
                <figcaption>
                    <p>{{ .Title }}</p>
                </figcaption>
                <a href="{{ $fullImage.RelPermalink }}" itemprop="contentUrl" data-size="{{$fullImage.Width}}x{{$fullImage.Height}}"></a><!-- put <a> last so it is stacked on top -->
              </figure>
            </div>           

        {{ end }}
    {{ end }}
</div>
